



### API

#### REST API definition

```java
	
    @PostMapping(value = "/carts", consumes = "application/vnd.active.cart-service.v1+json")
    public CreateCartsResp createCarts(@RequestBody @Valid CreateCartsReq request) {
        ...
        for (CartDto cartDto : request.getCartDtoList()) {
            for (CartItemDto cartItemDto : cartDto.getCartItemDtoList()) {
            CartItem cartItem = new CartItem();    
            List<Rule> prodRules = productRepo.findProductFeeRulesByProductId(cartItemDto.getProductId());
            CartItemFact cif = cartItemDto.getCartItemFact();
            cif.getKvFactPairs.add(new KVFactPair("currency", cart.getCurrency());
            cif.getKvFactPairs.add(new KVFactPair("priceDate", cart.getPriceDate());
            ProductFact fact = new ProductFact(cif.getKvFactPairs());
            ruleEngine.runRules(prodRules, fact);
            LOG.info("rule execution result: {}", fact.getResult());
            cartItem.setPrice(fact.getResult().getAmount());
            cartItem.setProductId(cartItemDto.getProductId());
            cartItem.setIdentifier();
        }
        return null;
        
    }
```



### Request

##### CreateCartsReq

```java
public class CreateCartsReq {
    
    private List<CartDto> cartDtoList;
}
```




##### CartDto

```java
public class CartDto {
    private String identifier;
    private List<CartItemDto> cartItemDtoList;
    private Currency currency;
    private DateTime priceDate;

}
```

##### CartItemDto

```java
public class CartItemDto {
    
    private String identifier;
    
    private Long productId;

    private CartItemFact cartItemFact;

}
```


##### CartItemFact

```java
public class CartItemFact {
    
    private List<KVFactPair> kvFactPairs;

}
```

##### KVFactPair

```java
public class CartItemFact {
    
    private String key;
    private Object value;

}
```

##### Cart

```java
public class Cart {
    private String identifier;
    private List<CartItem> cartItemList;
    private Currency currency;
    private DateTime priceDate;

}
```

##### CartItem

```java
public class CartItem {
    
    private String identifier;
    
    private Long productId;

    private BigDecimal price;

}
```


### Response

##### CreateCartsResp


```java
public class CreateCartsResp {
    
    private List<Cart> cartList;
}