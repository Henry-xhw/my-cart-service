



### API

#### REST API definition

```java
	
    @PostMapping(value = "/carts", consumes = "application/vnd.active.cart-service.v1+json")
    public CreateCartsResp createCarts(@RequestBody @Valid CreateCartsReq request) {
        ...
        for (Cart cart : request.getCarts) {
            for (CartItem cartItem : cart.getCartItems)
            List<Rule> prodRules = productRepo.findProductFeeRulesByProductId(item.getProductId());
            CartItemFact cif = item.getCartItemFact();
            cif.getKvFactPairs.add(new KVFactPair("currency", cart.getCurrency());
            cif.getKvFactPairs.add(new KVFactPair("priceDate", cart.getPriceDate());
            ProductFact fact = new ProductFact(cif.getKvFactPairs());
            ruleEngine.runRules(prodRules, fact);
            LOG.info("rule execution result: {}", fact.getResult());
            item.setPrice(fact.getResult().getAmount());
        }
        return null;
        
    }
```



### Request

##### CreateCartsReq

```java
public class CreateCartsReq {
    
    private List<Cart> carts;
}
```




##### Cart

```java
public class Cart {
    private String identifier;
    private List<CartItem> cartItems;
    private Currency currency;
    private DateTime priceDate;

}
```

##### CartItem

```java
public class CartItem {
    
    private String identifier;
    
    private Long productId;

    private CartItemFact cartItemFact;
    
    private BigDecimal price;

}
```


##### CartItemFact

```java
public class CartItemFact {
    
    private List<KVFactPair> kvFactPairs;

}
```

##### KVFactPair

```java
public class CartItemFact {
    
    private String key;
    private Object value;

}
```


### Response

##### CreateCartsResp


```java
public class CreateCartsResp {
    
    private List<Cart> carts;
}